<!-- livebook:{"app_settings":{"access_type":"public","output_type":"rich","slug":"karel-dreams"}} -->

# Karel Dreams

```elixir
Mix.install([
  {:kino, "~> 0.11.0"}
])
```

## Images

```elixir
defmodule Karel.Images do
  def karel do
    """
    <svg viewBox="0 0 132.29166 132.29167">
       <path
       id="head"
       style="fill:#a87ace"
       d="m 40.01112,7.3210001 c -6.510779,0 -11.752254,5.2414759 -11.752254,11.7522539 v 29.929439 c 0,6.510778 5.241475,11.752254 11.752254,11.752254 h 52.26916 c 6.510777,0 11.75277,-5.241476 11.75277,-11.752254 V 19.073254 c 0,-6.510778 -5.241993,-11.7522539 -11.75277,-11.7522539 z M 37.856212,63.970771 c -0.415305,0.0019 -0.833544,0.01862 -1.25367,0.05064 -5.041508,0.384316 -10.352095,2.930711 -13.941784,7.506002 -4.786253,6.100388 -6.010195,15.862897 0.857828,28.006042 l 3.427698,-1.939933 c -6.347047,-11.22202 -4.959147,-18.824918 -1.185457,-23.63473 3.773689,-4.809811 10.437141,-6.773237 14.833719,-5.757788 l 0.886768,-3.837492 c -1.160308,-0.267988 -2.379186,-0.398371 -3.625102,-0.392741 z m 56.579492,0 c -1.245915,-0.0056 -2.464794,0.124753 -3.625102,0.392741 l 0.886768,3.837492 c 4.396577,-1.015449 11.06004,0.947977 14.83372,5.757788 3.77369,4.809812 5.1616,12.41271 -1.18545,23.634733 l 3.42769,1.939933 c 6.86803,-12.143145 5.64357,-21.905654 0.85731,-28.006042 -3.58968,-4.575291 -8.89975,-7.121686 -13.941263,-7.506002 -0.42013,-0.03203 -0.838368,-0.04877 -1.253673,-0.05064 z M 49.09687,99.085424 V 112.3456 c -0.379506,1.37909 -1.419306,2.38957 -2.675806,2.59984 h -0.95498 c -2.134296,0 -3.851962,1.68459 -3.851962,3.77754 v 7.14479 c 0,2.09296 1.717666,3.77806 3.851962,3.77806 h 14.511775 c 2.134297,0 3.852995,-1.6851 3.852995,-3.77806 v -7.14479 c 0,-2.09295 -1.718698,-3.77754 -3.852995,-3.77754 h -2.035534 c -1.256504,-0.21027 -2.296298,-1.22074 -2.675806,-2.59984 V 99.085424 Z m 26.84694,0 V 112.3456 c -0.379506,1.37909 -1.419306,2.38957 -2.675806,2.59984 h -0.954981 c -2.134295,0 -3.851961,1.68459 -3.851961,3.77754 v 7.14479 c 0,2.09296 1.717666,3.77806 3.851961,3.77806 h 14.512293 c 2.134297,0 3.852478,-1.6851 3.852478,-3.77806 v -7.14479 c 0,-2.09295 -1.718181,-3.77754 -3.852478,-3.77754 h -2.036052 c -1.256503,-0.21027 -2.296298,-1.22074 -2.675805,-2.59984 V 99.085424 Z" /><path
       id="body"
       style="fill:#3dbcc0"
       d="m 54.52824,2.6458333 c -0.746052,0 -1.346688,0.600636 -1.346688,1.3466878 v 0.5105632 c 0,0.7460518 0.600636,1.3466878 1.346688,1.3466878 h 10.063468 v 1.471228 h 3.108337 V 5.8497721 H 77.76403 c 0.746053,0 1.346688,-0.600636 1.346688,-1.3466878 V 3.9925211 c 0,-0.7460518 -0.600635,-1.3466878 -1.346688,-1.3466878 z M 47.782915,60.754947 c -5.143282,0 -9.283671,4.140906 -9.283671,9.284188 v 23.643518 c 0,5.14328 4.140389,9.283667 9.283671,9.283667 h 36.725923 c 5.143282,0 9.284188,-4.140387 9.284188,-9.283667 V 70.039135 c 0,-5.143282 -4.140906,-9.284188 -9.284188,-9.284188 z M 28.177911,96.100593 a 7.4036958,6.2776936 46.631552 0 0 -0.856279,0.07751 7.4036958,6.2776936 46.631552 0 0 -2.960543,1.437121 7.4036958,6.2776936 46.631552 0 0 -1.603519,2.873736 7.4036958,6.2776936 46.631552 0 0 1.180806,5.62808 l 0.0036,-0.004 a 1.2535163,1.2535163 0 0 0 0.158647,0.20825 1.2535163,1.2535163 0 0 0 1.696537,0.11628 l 0.135393,-0.12764 a 1.2535163,1.2535163 0 0 0 0.02222,-0.0253 l 0.0021,0.002 3.485059,-3.2923 3.485575,-3.292315 -0.0015,-0.0021 a 1.2535163,1.2535163 0 0 0 0.02584,-0.02067 l 0.136426,-0.128158 A 1.2535163,1.2535163 0 0 0 33.068633,97.850416 1.2535163,1.2535163 0 0 0 32.869679,97.6804 l 0.0036,-0.0036 a 7.4036958,6.2776936 46.631552 0 0 -4.69532,-1.576648 z m 75.935939,0 a 6.2776936,7.4036958 43.368448 0 0 -4.695324,1.576648 l 0.004,0.0036 a 1.2535163,1.2535163 0 0 0 -0.19947,0.170016 1.2535163,1.2535163 0 0 0 -0.0191,1.700671 l 0.13591,0.128158 a 1.2535163,1.2535163 0 0 0 0.0264,0.02067 l -0.002,0.0021 3.485574,3.292314 3.48506,3.2923 0.002,-0.002 a 1.2535163,1.2535163 0 0 0 0.0222,0.0253 l 0.13539,0.12764 a 1.2535163,1.2535163 0 0 0 1.69654,-0.11628 1.2535163,1.2535163 0 0 0 0.15865,-0.20825 l 0.004,0.004 a 6.2776936,7.4036958 43.368448 0 0 1.18029,-5.62808 6.2776936,7.4036958 43.368448 0 0 -1.60352,-2.873735 6.2776936,7.4036958 43.368448 0 0 -2.96003,-1.437121 6.2776936,7.4036958 43.368448 0 0 -0.85679,-0.07751 z" /><path
       d="m 61.742687,85.892684 v 3.654422 h 1.191317 c 0.794205,0 1.357662,0.155623 1.690371,0.466868 0.343441,0.300508 0.515162,0.697611 0.515162,1.191308 0,0.482966 -0.171721,0.880069 -0.515162,1.191309 -0.332709,0.300513 -0.896166,0.45077 -1.690371,0.45077 h -5.006725 c -0.794205,0 -1.363028,-0.150257 -1.706469,-0.45077 -0.332709,-0.31124 -0.499064,-0.713709 -0.499064,-1.207406 0,-0.482966 0.17172,-0.874703 0.515161,-1.175211 0.343441,-0.311245 0.906899,-0.466868 1.690372,-0.466868 H 58.44244 V 76.635879 h -0.515161 c -0.794205,0 -1.363028,-0.150257 -1.706469,-0.45077 -0.332709,-0.31124 -0.499064,-0.713709 -0.499064,-1.207406 0,-0.493697 0.166355,-0.8908 0.499064,-1.191308 0.343441,-0.311245 0.912264,-0.466868 1.706469,-0.466868 l 5.006725,0.01607 c 0.794205,0 1.357662,0.150257 1.690371,0.45077 0.343441,0.300508 0.515162,0.697611 0.515162,1.191308 0,0.493698 -0.171721,0.896167 -0.515162,1.207406 -0.332709,0.300514 -0.896166,0.450771 -1.690371,0.450771 h -1.191317 v 4.894032 l 7.196408,-5.03892 c -0.34344,-0.246847 -0.579557,-0.477597 -0.708351,-0.69225 -0.128787,-0.214648 -0.193181,-0.477595 -0.193181,-0.78884 0,-0.504429 0.166355,-0.912264 0.499064,-1.223504 0.343441,-0.311245 0.912264,-0.466868 1.706469,-0.466868 l 3.364646,0.01607 c 0.794206,0 1.357663,0.150257 1.690372,0.45077 0.343441,0.300508 0.515161,0.697611 0.515161,1.191309 0,0.482965 -0.17172,0.880068 -0.515161,1.191308 -0.332709,0.311245 -0.858602,0.466868 -1.577679,0.466868 l -5.924355,5.183808 c 1.105452,0.633217 2.14114,1.599145 3.107065,2.897786 0.976664,1.298635 1.840632,2.908512 2.591904,4.829633 h 0.885435 c 0.783474,0 1.341565,0.155623 1.674274,0.466868 0.343441,0.300508 0.515161,0.697611 0.515161,1.191308 0,0.482965 -0.166354,0.880068 -0.499063,1.191308 -0.332709,0.300513 -0.896166,0.45077 -1.690372,0.45077 H 71.386111 C 70.69923,91.205235 69.947952,89.638286 69.132277,88.146461 68.466865,86.933686 68.044082,85.92072 67.44306,85.373363 66.85277,84.815269 65.753086,83.96452 64.926679,83.631811 Z"
       id="k"
       style="fill:#ffffff" /><path
       id="eye-white"
       style="fill:#ffffff"
       d="m 51.223488,22.149552 c -6.944679,-7.1e-5 -12.574497,5.629747 -12.574426,12.574426 -7.1e-5,6.944679 5.629747,12.574497 12.574426,12.574426 6.944679,7.1e-5 12.574497,-5.629747 12.574426,-12.574426 7.1e-5,-6.944679 -5.629747,-12.574497 -12.574426,-12.574426 z m 29.844689,0 c -6.944679,-7.1e-5 -12.574497,5.629747 -12.574426,12.574426 -7.1e-5,6.944679 5.629747,12.574497 12.574426,12.574426 6.944679,7.1e-5 12.574497,-5.629747 12.574426,-12.574426 7.1e-5,-6.944679 -5.629747,-12.574497 -12.574426,-12.574426 z" /><path
       id="eye-dark"
       style="fill:#525252"
       d="m 51.223746,21.34185 c -7.381225,0 -13.383163,6.001419 -13.383163,13.382645 0,7.381227 6.001938,13.381095 13.383163,13.381095 7.381225,0 13.382645,-5.999868 13.382645,-13.381095 0,-7.381226 -6.00142,-13.382645 -13.382645,-13.382645 z m 29.844689,0 c -7.381224,0 -13.383162,6.001419 -13.383162,13.382645 0,7.381227 6.001938,13.381095 13.383162,13.381095 7.381226,0 13.382646,-5.999868 13.382646,-13.381095 0,-7.381226 -6.00142,-13.382645 -13.382646,-13.382645 z m -29.844689,1.615405 c 6.507904,0 11.76569,5.259338 11.76569,11.76724 0,6.507903 -5.257786,11.76569 -11.76569,11.76569 -6.507905,0 -11.76569,-5.257787 -11.76569,-11.76569 0,-6.507902 5.257785,-11.76724 11.76569,-11.76724 z m 29.844689,0 c 6.507905,0 11.76569,5.259338 11.76569,11.76724 0,6.507903 -5.257785,11.76569 -11.76569,11.76569 -6.507904,0 -11.76569,-5.257787 -11.76569,-11.76569 0,-6.507902 5.257786,-11.76724 11.76569,-11.76724 z m -29.844689,5.366597 c -3.534731,-1.01e-4 -6.400227,2.865396 -6.400126,6.400126 -1.01e-4,3.534731 2.865395,6.400227 6.400126,6.400126 3.53473,1.01e-4 6.400227,-2.865395 6.400126,-6.400126 1.01e-4,-3.53473 -2.865396,-6.400227 -6.400126,-6.400126 z m 29.844689,0 c -3.53473,-1.01e-4 -6.400227,2.865396 -6.400126,6.400126 -1.01e-4,3.534731 2.865396,6.400227 6.400126,6.400126 3.534731,1.01e-4 6.400227,-2.865395 6.400126,-6.400126 1.01e-4,-3.53473 -2.865395,-6.400227 -6.400126,-6.400126 z" /><path
       id="eye-light"
       style="fill:#ffffff"
       d="m 51.223488,33.220711 a 1.5032583,1.5032583 0 0 0 -1.503268,1.503267 1.5032583,1.5032583 0 0 0 1.503268,1.503268 1.5032583,1.5032583 0 0 0 1.503267,-1.503268 1.5032583,1.5032583 0 0 0 -1.503267,-1.503267 z m 29.844689,0 a 1.5032583,1.5032583 0 0 0 -1.503267,1.503267 1.5032583,1.5032583 0 0 0 1.503267,1.503268 1.5032583,1.5032583 0 0 0 1.503268,-1.503268 1.5032583,1.5032583 0 0 0 -1.503268,-1.503267 z" />
    </svg>
    """
  end
end
```

## Code

```elixir
defmodule Karel.Board do
  defstruct [:cols, :rows]
  def new(cols), do: new(cols, cols)
  def new(cols, rows), do: %__MODULE__{cols: cols, rows: rows}
end
```

```elixir
defmodule Karel.Kino do
  use Kino.JS
  alias Karel.Images

  def new(board) do
    images = %{karel: Images.karel()}
    Kino.JS.new(__MODULE__, %{cols: board.cols, html: html(board), images: images})
  end

  defp html(board) do
    ~s|<div class="board">#{html_fields(board)}</div>|
  end

  defp html_fields(board) do
    for x <- 1..board.cols, y <- 1..board.rows do
      ~s|<div id="board-field-#{x}-#{y}"></div>|
    end
  end

  asset "main.js" do
    """
    export function init(ctx, board) {
      document.querySelector(':root').style.setProperty('--board-cols', board.cols);
      ctx.importCSS("main.css")
      ctx.root.innerHTML = board.html
      document.getElementById('board-field-1-1').innerHTML = board.images.karel
    }
    """
  end

  asset "main.css" do
    """
    :root {
      --border-color: White;
      --border-size: 2px;
      --bg-color: LightGrey;
    }
    .board {
      background: var(--border-color);
      border: var(--border-size) solid var(--border-color);
      display: grid;
      grid-gap: var(--border-size);
      grid-template-columns: repeat(var(--board-cols), auto);
      width: 50vw;
    }
    .board div {
      background: var(--bg-color);
      aspect-ratio: 1/1;
      position: relative;
    }
    .board div svg {
      position: absolute;
      width: 100%;
    }
    """
  end
end
```

```elixir
Karel.Kino.new(Karel.Board.new(10))
```
